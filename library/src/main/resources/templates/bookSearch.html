<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <style>
            table {
                width: 100%;
                border-collapse: collapse;
            }

            th, td {
                border-bottom: 1px solid #555555;
                padding: 10px;
                text-align:center; 
            }
        </style>

    </head>
    <body>
    <!-- <script th:src="@{/js/search.js}"></script> -->
    <div class="col-md-12">
        <h1>도서 검색</h1>
        <div class="col-md-4">
            <form th:action="@{/book-search}" method="post">
                <input type="text" th:value="${keyword}" name="keyword" placeholder="도서명 또는 ISBN을 입력해주세요."/>
                <button th:text="검색" type="submit"/>
            </form>
        </div>

        <hr>
        <div>
            <table class="table">
                <tbody>
                <tr th:each="bookDto : ${bookDtoList}" onclick="selectElement(this)" style="cursor : pointer;" \>
                    <td><img th:src="@{${bookDto.imageURL}}" width="100" height="150"/></td>
                    <td th:text="${bookDto.title}">title</td>
                    <td th:text="${bookDto.author}">authorA</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
	    function selectElement(selectedElement) {
	        addDataToForm(selectedElement);
	        window.close();
	    }
	
	    // 선택된 데이터를 add form 에 추가하는 함수
	    function addDataToForm(ele) {
	        console.log('addDateToForm' + ele);
	
	        let elements = ele.getElementsByTagName("td");
	        let data = {
	            title: elements[1].innerText,
	            author: elements[2].innerText,
	            imageURL: elements[0].querySelector('img').getAttribute('src')
	        };
	        
	        // 부모 창으로 element 전달
	        opener.document.getElementById("add_form_imageURL").value = data.imageURL;
	        opener.document.getElementById("add_form_title").value = data.title;
	        opener.document.getElementById("add_form_author").value = data.author;
	
	    }
    </script>
    </body>
</html>
